<!--Script-->
<script type="text/javascript">

        function displayTable(data) {

        if (!!data.TableContent) {
            let cardId = "tracified" + data.WidgetId
            createCard(cardId, "Table")
            //craete boostarp cards Node and it to barchart 
            let tableDiv = document.createElement("div")
            tableDiv.style = "width:500px; heigth:fit-content;"
            let tableNode = document.createElement("table");
            tableNode.className = `table table-bordered`;
            tableNode.innerHTML = data.TableContent
            tableDiv.append(tableNode)
            document.getElementById(cardId).appendChild(tableDiv);
        }

    }

        function displayProofBot(dataArray) {
            console.log('dataArray', dataArray)
            let cardId = "tracified" + dataArray.WidgetId
            createCard(cardId, "Table")
            let botNode = document.getElementById(cardId)
            dataArray.Batch.map((proofBotUrlbatchSpecific, i) => {
                let batchTitle = document.createElement("h5");
                batchTitle.className = "text-start"
                batchTitle.append(document.createTextNode(proofBotUrlbatchSpecific.BatchTitle))
            botNode.append(batchTitle)
            proofBotUrlbatchSpecific.BotUrls.map((data) => {
                const ul = document.createElement("ul");
                ul.id = `list-group`;
                ul.className = `list-group mb-4 text-start`;
                let textNode = document.createTextNode(data.Type)
                ul.append()
                data.Urls.map((proof) => {
                    const li = document.createElement("li");
                    li.className = `list-group-item`
                    const textnode = document.createTextNode(proof);
                    li.appendChild(textnode);
                    ul.append(li);
                })
                let prooftype = document.createElement("div")
                prooftype.className = `card-title  text-start`;
                prooftype.append(textNode)
                botNode.append(prooftype)
                botNode.append(ul)
            })

        })
    }

        function displayStat(data) {
            let cardId = "tracified" + data.WidgetId
            createCard(cardId, "Stat")
            let statNode = document.getElementById(cardId);

            data.StatData.map((detail, i) => {
                const newDiv = document.createElement("div");
                newDiv.id = `stat`;
                newDiv.className = `mb-2`;
            newDiv.style = `height:70px; width:500px`
            newDiv.innerHTML = `<h5 style="background-color:${detail.Color}">${detail.Key}</h5>
                        <h6 >${detail.Value}</h6> `
            statNode.append(newDiv)
        })

    }

        function displayImages(data) {
            let cardId = "tracified" + data.WidgetId

        createCard(cardId, "Image")
        let image = document.createElement("img")
        image.alt = ""
        image.src = `data:image/${data.Type};base64,${data.Base64Image}`
        image.width = '500'
        image.height = '400'
        let imageNode = document.getElementById(cardId);
        imageNode.append(image)
    }

        function createCard(cardId, name) {
            let card = document.createElement("div")
        card.className = `card text-center justify-content-center m-3`;
        card.style = "min-width: 20rem; max-height: fit-content; "
        let cardTitle = document.createElement("h5")
        cardTitle.className = "card-header"
        cardTitle.appendChild(document.createTextNode(name));
        card.appendChild(cardTitle);
        let cardBody = document.createElement("div");
        cardBody.className = "card-body text-center  justify-content-center"
        cardBody.id = cardId
        card.append(cardBody)
        document.getElementById("container").appendChild(card);
        }

        function displayBarchart(data) {
            let cardId = "tracified" + data.WidgetId
            createCard(cardId, "BarChart")
            let margin = 50;
            let width = data.Width - margin * 2;
            let height = data.Height - margin * 2;
            const svg = d3.select(`#${cardId}`)
                .append('svg')
                .attr('width', width + margin * 2)
                .attr('height', height + margin * 2)
                .append('g')
                .attr('transform', 'translate(' + margin + ',' + margin + ')');

            // Create the X-axis band scale
            const x = d3
                .scaleBand()
                .range([0, width])
                .domain(data.ChartData.map((d) => d.Name))
                .padding(0.2);

            // Draw the X-axis on the DOM
            svg
                .append('g')
                .attr('transform', 'translate(0,' + height + ')')
                .call(d3.axisBottom(x))
                .style('color', 'black')
                .append('text')
                .attr('y', height - 60)
                .attr('x', width - 200)
                .attr('text-anchor', 'end')
                .attr('stroke', data.FontColor)
                .style('fill', data.FontColor)
                .style('font-size', data.FontSize + 'px')
                .text(data.XAxis);

            // Create the Y-axis band scale
            const y = d3.scaleLinear()
                .domain([data.Domain[0], data.Domain[1]])
                .range([height, 0]);
            // add title
            svg.append("text")
                .attr("x", (width / 2))
                .attr("y", 0 - (margin / 2))
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("text-decoration", "underline")
                .text(data.ChartTitle);
            // Draw the Y-axis on the DOM
            svg.append('g')
                .call(d3.axisLeft(y))
                .style('color', 'black')
                .append('text')
                .attr('transform', 'rotate(-90)')
                .attr('y', 6)
                .attr('dy', '-4.6em')
                .attr('text-anchor', 'end')
                .attr('stroke', data.FontColor)
                .style('fill', data.FontColor)
                .style('font-size', data.FontSize + 'px')
                .text(data.YAxis);

            // Create and fill the bars
            svg.selectAll('bars')
                .data(data.ChartData)
                .enter()
                .append('rect')
                .attr('x', (d) => x(d.Name))
                .attr('y', (d) => y(d.Value))
                .attr('width', x.bandwidth())
                .attr('height', (d) => height - y(d.Value))
                .attr('fill', (d, i) => data.Color[i])
                .style('font-size', data.FontSize + 'px');
        }

        function displayPiechart(data) {
            let cardId = "tracified" + data.WidgetId
            createCard(cardId, "PieChart")
            margin = 20;
            // The radius of the pie chart is half the smallest side
            let radius = Math.min(data.Width, data.Height) / 2 - this.margin;

            let svg = d3.select(`#${cardId}`)
                .append('svg')
                .attr('width', data.Width)
                .attr('height', data.Height + 50)
                .append('g')
                .attr(
                    'transform',
                    'translate(' + data.Width / 2 + ',' + data.Height / 2 + ')'
                );

            // Compute the position of each group on the pie:
            const pie = d3.pie().value((d) => Number(d.Value));

            // Build the pie chart
            svg
                .selectAll('pieces')
                .data(pie(data.ChartData))
                .enter()
                .append('path')
                .attr('d', d3.arc().innerRadius(0).outerRadius(radius))
                .attr('fill', (d, i) => data.Color[i])
                .attr('stroke', '#121926')
                .style('stroke-width', '1px');

            // Add labels
            const labelLocation = d3.arc().innerRadius(100).outerRadius(radius);

            svg
                .selectAll('pieces')
                .data(pie(data.ChartData))
                .enter()
                .append('text')
                .text((d) => d.data.Name)
                .attr(
                    'transform',
                    (d) => 'translate(' + labelLocation.centroid(d) + ')'
                )
                .style('text-anchor', 'middle')
                .style('font-size', data.FontSize + 'px');

            svg
                .append('g')
                .append('text')
                .attr('y', data.Height - 170)
                .text(data.ChartTitle)
                .style('text-anchor', 'middle')
                .style('font-size', data.FontSize + 'px')
                .attr('stroke', data.FontColor)
                .style('fill', data.FontColor);
        }

        function displayBubblechart(data) {
            let cardId = "tracified" + data.WidgetId

        createCard(cardId, "BubbleChart")
        margin = 5;
        width = data.Width - margin;
        height = data.Height - margin;

        let svg = d3
            .select(`#${cardId}`)
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        // Initialize the circle: all located at the center of the svg area
        svg
            .selectAll('circle')
            .data(data.ChartData)
            .enter()
            .append('circle')
            .attr('cx', function (d) {
                return d.X + 100;
            })
            .attr('cy', function (d) {
                return d.Y;
            })
            .attr('r', function (d) {
                let r = Math.sqrt(d.Value) / Math.PI;
                return r;
            })
            .attr('fill', function (d, i) {
                return data.Color[i];
            });

        svg
            .selectAll('text')
            .data(data.ChartData)
            .enter()
            .append('text')
            .attr('x', function (d) {
                let r = d.X + Math.sqrt(d.Value / Math.PI)

                return r;
            })
            .attr('y', function (d) {
                return d.Y + 3;
            })
            .attr('x', function (d) {
                return d.X + 120;
            })
            .text(function (d) {
                return d.Name;
            })
            .style('font-size', data.FontSize + 'px')
            .style('fill', data.FontColor);

        svg
            .append('g')
            .append('text')
            .attr('y', height - 10)
            .attr('x', width / 2)
            .text(data.ChartTitle)
            .style('text-anchor', 'middle')
            .style('font-size', data.FontSize + 'px')
            .attr('stroke', data.FontColor)
            .style('fill', data.FontColor);
    }


</script>
<!--Script-->